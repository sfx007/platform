# HANDOFF

## Current Architecture
- Next.js App Router + TypeScript + Tailwind frontend.
- Prisma + SQLite backend (`prisma/dev.db`).
- Content ingestion is manifest-driven from `content/trust_platform_content/manifest.json` using `gray-matter`.
- Visual mapping pack lives at `visuals/` and is imported into DB tables.
- Submission pipeline is centralized in `lib/submissions.ts` and shared by API routes.

## What Works
- Content pack parsing and sync path are implemented:
  - `lib/content-loader.ts`
  - `scripts/sync-content.ts`
- Visual mapping sync/validate scripts are implemented:
  - `scripts/sync-visuals.ts`
  - `scripts/validate-visuals.ts`
- Required core routes are implemented:
  - `/parts`
  - `/parts/[partSlug]`
  - `/parts/[partSlug]/lessons/[lessonSlug]`
  - `/parts/[partSlug]/quest`
  - `/reviews`
  - `/progress`
- Lesson/quest pages show a Hero Visual Model with TASL attribution and license accordion.
- Lesson/quest proof submission supports:
  - pasted text
  - optional file upload (`/uploads` local storage)
  - regex auto-check when available
  - manual pass fallback
- Review scheduling uses lesson metadata when present (`reviewScheduleDays`) else defaults `[1,3,7,14]`.
- Progress page includes streak, recent activity, and next recommended lesson.
- Quick-review workflow includes `Mark Reviewed` action and prompts.
- Part 1 lessons + quest rewritten in simple English.
- Week 2 (Days 8-13) rewritten to Day 1 quality format.

## What Is Unfinished
- Migration SQL was added but not executed in this environment.
- Content DB needs re-sync after Week 2 rewrite.
- Full runtime QA (manual app walkthrough + `npm test`) is pending because Node.js is not available in this terminal.

## How To Run Locally
1. Install Node.js 20+.
2. `npm install`
3. Apply DB changes: `npm run db:push` (or run Prisma migrations if preferred).
4. Sync content: `npm run content:sync`
5. Sync visuals: `npm run visuals:sync` then `npm run visuals:validate`
6. Start: `npm run dev`
7. Optional tests: `npm test`

## Gotchas
- This terminal lacks `node`/`npm`; no local execution was possible here.
- Prisma client must be regenerated by your local Node toolchain after schema changes.
- VisualAsset uses `localPath` for image URL (external `download_url` if not stored locally).
